<meta charset="utf8" />
<script type="module">
    WebAssembly.instantiateStreaming(fetch("ipu.wasm"), self).then(module => {
        const ipu = module.instance.exports;
        console.warn(ipu);

        const source = ipu.new(Float32Array, 12);
        const values = ipu.new(Float32Array, 12);
        const target = ipu.new(Float32Array, 12);
        const dwtest = ipu.new(DataView, 2440);

        console.table([
            { view: source, offset: source.byteOffset, length: source.length, buffer: source.buffer },
            { view: values, offset: values.byteOffset, length: values.length, buffer: values.buffer },
            { view: target, offset: target.byteOffset, length: target.length, buffer: target.buffer },
            { view: dwtest, offset: dwtest.byteOffset, length: dwtest.byteLength, buffer: dwtest.buffer },
        ]);

        setTimeout(async () => {
            console.log("calling add...")
            const call = await ipu.add(source, values, target);
            console.log("results came:", call)
            console.warn(call);
        }, 1000)
    });
</script>